<div class="section-header" [ngClass]="'align-' + textAlign">

  <!-- Reusable Subtitle-Template (steuert Tag + Margins zentral) -->
  <ng-template #subtitleTpl let-mt="mt" let-mb="mb">
    <ng-container [ngSwitch]="subtitleTag">
      <h1 *ngSwitchCase="'h1'" class="section-subtitle" [style.marginTop.px]="mt" [style.marginBottom.px]="mb">
        {{ subtitle }}
      </h1>
      <h2 *ngSwitchCase="'h2'" class="section-subtitle" [style.marginTop.px]="mt" [style.marginBottom.px]="mb">
        {{ subtitle }}
      </h2>
      <h3 *ngSwitchDefault class="section-subtitle" [style.marginTop.px]="mt" [style.marginBottom.px]="mb">
        {{ subtitle }}
      </h3>
    </ng-container>
  </ng-template>

  <!-- ============================= -->
  <!-- FALL A: Linie ÜBER dem Title -->
  <!-- ============================= -->
  <ng-container *ngIf="lineAboveTitle; else notLineAbove">

    <!-- Linie über dem Title -->
    <div class="line-wrapper" [style.marginBottom.px]="lineMarginBottom">
      <img *ngIf="lineImage" [src]="lineImage" alt="line image" [style.width.px]="lineWidth" [ngClass]="{
             'animated-line': animateLine,
             'horizontal-mask': maskDirection === 'horizontal',
             'horizontal-mask-rtl': maskDirection === 'rtl',
             'circular-mask': maskDirection === 'circular'
           }" />
    </div>

    <!-- Subtitle (falls über dem Title gewünscht) -->
    <ng-container *ngIf="subtitlePosition === 'above'">
      <ng-container *ngTemplateOutlet="subtitleTpl; context: { mb: subtitleOffset }"></ng-container>
    </ng-container>

    <!-- Title -->
    <h1>{{ title }}</h1>

    <!-- Subtitle (falls unter dem Title gewünscht) -->
    <ng-container *ngIf="subtitlePosition === 'below'">
      <ng-container *ngTemplateOutlet="subtitleTpl; context: { mt: subtitleOffset }"></ng-container>
    </ng-container>

    <!-- Info-Text -->
    <p class="section-info-text" [style.marginTop.px]="infoOffset">
      {{ infoText }}
    </p>

    <!-- Optionale Linie unter dem Info-Text -->
    <div class="line-wrapper" *ngIf="lineUnderInfoText" [style.display]="'flex'" [style.width]="'100%'"
      [style.marginTop.px]="lineMarginBottom" [style.justifyContent]="lineAlign">
      <img *ngIf="lineImage" [src]="lineImage" alt="line image" [style.width.px]="lineWidth" [ngClass]="{
             'animated-line': animateLine,
             'horizontal-mask': maskDirection === 'horizontal',
             'horizontal-mask-rtl': maskDirection === 'rtl',
             'circular-mask': maskDirection === 'circular'
           }" />
    </div>
  </ng-container>

  <!-- ============================================ -->
  <!-- FALL B: Linie NICHT über dem Title (default) -->
  <!-- ============================================ -->
  <ng-template #notLineAbove>

    <!-- Variante B1: Subtitle ZWINGEND unter der Linie -->
    <ng-container *ngIf="subtitleUnderLine; else variantB2">
      <!-- Title -->
      <h1>{{ title }}</h1>

      <!-- Linie direkt unter dem Title (nur wenn NICHT unter Info-Text gewünscht) -->
      <div class="line-wrapper" *ngIf="!lineUnderInfoText" [style.display]="'flex'" [style.width]="'100%'"
        [style.marginBottom.px]="lineMarginBottom" [style.justifyContent]="'flex-start'">
        <img *ngIf="lineImage" [src]="lineImage" alt="line image" [style.width.px]="lineWidth" [ngClass]="{
               'animated-line': animateLine,
               'horizontal-mask': maskDirection === 'horizontal',
               'horizontal-mask-rtl': maskDirection === 'rtl',
               'circular-mask': maskDirection === 'circular'
             }" />
      </div>

      <!-- Subtitle immer UNTER der Linie -->
      <ng-container *ngTemplateOutlet="subtitleTpl; context: { mt: subtitleOffset }"></ng-container>

      <!-- Info-Text -->
      <p class="section-info-text" [style.marginTop.px]="infoOffset">
        {{ infoText }}
      </p>

      <!-- Optionale Linie unter dem Info-Text -->
      <div class="line-wrapper" *ngIf="lineUnderInfoText" [style.display]="'flex'" [style.width]="'100%'"
        [style.marginTop.px]="lineMarginBottom" [style.justifyContent]="lineAlign">
        <img *ngIf="lineImage" [src]="lineImage" alt="line image" [style.width.px]="lineWidth" [ngClass]="{
               'animated-line': animateLine,
               'horizontal-mask': maskDirection === 'horizontal',
               'horizontal-mask-rtl': maskDirection === 'rtl',
               'circular-mask': maskDirection === 'circular'
             }" />
      </div>
    </ng-container>

    <!-- Variante B2: Standard-Verhalten -->
    <ng-template #variantB2>
      <!-- Subtitle (falls über dem Title gewünscht) -->
      <ng-container *ngIf="subtitlePosition === 'above'">
        <ng-container *ngTemplateOutlet="subtitleTpl; context: { mb: subtitleOffset }"></ng-container>
      </ng-container>

      <!-- Title -->
      <h1>{{ title }}</h1>

      <!-- Subtitle (falls unter dem Title gewünscht) -->
      <ng-container *ngIf="subtitlePosition === 'below'">
        <ng-container *ngTemplateOutlet="subtitleTpl; context: { mt: subtitleOffset }"></ng-container>
      </ng-container>

      <!-- Linie unter dem Title (nur, wenn NICHT unter Info-Text gewünscht) -->
      <div class="line-wrapper" *ngIf="!lineUnderInfoText" [style.display]="'flex'" [style.width]="'100%'"
        [style.marginBottom.px]="lineMarginBottom" [style.justifyContent]="lineAlign">
        <img *ngIf="lineImage" [src]="lineImage" alt="line image" [style.width.px]="lineWidth" [ngClass]="{
               'animated-line': animateLine,
               'horizontal-mask': maskDirection === 'horizontal',
               'horizontal-mask-rtl': maskDirection === 'rtl',
               'circular-mask': maskDirection === 'circular'
             }" />
      </div>

      <!-- Info-Text -->
      <p class="section-info-text" [style.marginTop.px]="infoOffset">
        {{ infoText }}
      </p>

      <!-- Optionale Linie unter dem Info-Text -->
      <div class="line-wrapper" *ngIf="lineUnderInfoText" [style.display]="'flex'" [style.width]="'100%'"
        [style.marginTop.px]="lineMarginBottom" [style.justifyContent]="lineAlign">
        <img *ngIf="lineImage" [src]="lineImage" alt="line image" [style.width.px]="lineWidth" [ngClass]="{
               'animated-line': animateLine,
               'horizontal-mask': maskDirection === 'horizontal',
               'horizontal-mask-rtl': maskDirection === 'rtl',
               'circular-mask': maskDirection === 'circular'
             }" />
      </div>
    </ng-template>
  </ng-template>
</div>